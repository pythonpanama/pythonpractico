<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>7 Temas avanzados - Python Práctico</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "7 Temas avanzados";
    var mkdocs_page_input_path = "7.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Python Práctico</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Sobre el curso</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../temario/">Temario</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../faq/">Preguntas</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../0/">0 Empiece aqui</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../1/">1 Intro a Python</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../2/">2 Trabajando con Data</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../3/">3 Organización de un Programa</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../4/">4 Clases y Objetos</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../5/">5 Entrañas del Objeto</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../6/">6 Generadores</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">7 Temas avanzados</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#71-argumentos-variables">7.1 Argumentos variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#711-argumentos-de-variables-posicionales-args">7.1.1 Argumentos de variables posicionales (*args)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#712-argumentos-de-variables-de-palabra-clave-kwargs">7.1.2 Argumentos de variables de palabra clave (**kwargs)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#713-combinando-ambos">7.1.3 Combinando ambos</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#714-pasar-tuplas-y-dictados">7.1.4 Pasar tuplas y dictados</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#715-ejercicios">7.1.5 Ejercicios</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-71-un-ejemplo-simple-de-argumentos-variables">Ejercicio 7.1: un ejemplo simple de argumentos variables</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-72-pasar-tuplas-y-dictados-como-argumentos">Ejercicio 7.2: Pasar tuplas y dictados como argumentos</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-73-crear-una-lista-de-instancias">Ejercicio 7.3: Crear una lista de instancias</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-74-transferencia-de-argumentos">Ejercicio 7.4: Transferencia de argumentos</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#72-funciones-anonimas-y-lambda">7.2 Funciones anónimas y lambda</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#721-clasificacion-de-listas-revisada">7.2.1 Clasificación de listas revisada</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#722-funciones-de-devolucion-de-llamada">7.2.2 Funciones de devolución de llamada</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#723-lambda-funciones-anonimas">7.2.3 Lambda: funciones anónimas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#724-usando-lambda">7.2.4 Usando lambda</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#725-ejercicios">7.2.5 Ejercicios</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-75-ordenar-en-un-campo">Ejercicio 7.5: ordenar en un campo</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-76-ordenar-en-un-campo-con-lambda">Ejercicio 7.6: ordenar en un campo con lambda</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#73-funcion-de-retorno-y-cierres">7.3 Función de retorno y cierres</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#731-introduccion">7.3.1 Introducción</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#732-variables-locales">7.3.2 Variables locales</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#733-cierres">7.3.3 Cierres</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#734-usando-cierres">7.3.4 Usando cierres</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#735-evaluacion-retrasada">7.3.5 Evaluación retrasada</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#736-repeticion-de-codigo">7.3.6 Repetición de código</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#737-ejercicios">7.3.7 Ejercicios</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-77-uso-de-cierres-para-evitar-la-repeticion">Ejercicio 7.7: Uso de cierres para evitar la repetición</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-78-simplificacion-de-llamadas-a-funciones">Ejercicio 7.8: Simplificación de llamadas a funciones</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-79-poniendolo-en-practica">Ejercicio 7.9: Poniéndolo en práctica</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#74-decoradores-de-funciones">7.4 Decoradores de funciones</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#741-ejemplo-de-registro">7.4.1 Ejemplo de registro</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#742-observacion">7.4.2 Observación</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#743-codigo-que-hace-el-registro">7.4.3 Código que hace el registro</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#744-decoradores">7.4.4 Decoradores</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#comentario">Comentario</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#745-ejercicios">7.4.5 Ejercicios</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-710-un-decorador-de-tiempos">Ejercicio 7.10: un decorador de tiempos</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#75-metodos-estaticos-y-de-clase">7.5 Métodos estáticos y de clase</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#751-decoradores-predefinidos">7.5.1 Decoradores predefinidos</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#752-metodos-estaticos">7.5.2 Métodos estáticos</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#753-metodos-de-clase">7.5.3 Métodos de clase</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#754-ejercicios">7.5.4 Ejercicios</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#ejercicio-711-metodos-de-clase-en-la-practica">Ejercicio 7.11: Métodos de clase en la práctica</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../8/">8 Prueba y Depuración</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../9/">9 Paquetes</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../licencia/">Licencia</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Python Práctico</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>7 Temas avanzados</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="7-temas-avanzados">7. Temas Avanzados</h1>
<p>En esta sección, veremos una pequeña colección de algunas características avanzadas de Python que posiblemente encontremos en nuestra programación cotidiana. Los temas en esta sección son sólo una introducción a estas ideas.</p>
<h2 id="71-argumentos-variables">7.1 Argumentos variables</h2>
<p>Esta sección cubre los argumentos de funciones variadas, a veces descritos como <em>argsy </em>*kwargs.</p>
<h3 id="711-argumentos-de-variables-posicionales-args">7.1.1 Argumentos de variables posicionales (<code>*args</code>)</h3>
<p>Se dice que una función que acepta cualquier número de argumentos usa argumentos variables. Por ejemplo:</p>
<pre><code class="language-python">def f(x, *args):
    ...
</code></pre>
<p>Llamada de función.</p>
<pre><code class="language-python">f(1,2,3,4,5)
</code></pre>
<p>Los argumentos adicionales se pasan como una tupla.</p>
<pre><code class="language-python">def f(x, *args):
    # x -&gt; 1
    # args -&gt; (2,3,4,5)
</code></pre>
<h3 id="712-argumentos-de-variables-de-palabra-clave-kwargs">7.1.2 Argumentos de variables de palabra clave (<code>**kwargs</code>)</h3>
<p>Una función también puede aceptar cualquier número de argumentos de palabras clave. Por ejemplo:</p>
<pre><code class="language-python">def f(x, y, **kwargs):
    ...
</code></pre>
<p>Llamada de función.</p>
<pre><code class="language-python">f(2, 3, flag=True, mode='fast', header='debug')
</code></pre>
<p>Las palabras clave adicionales se pasan en un diccionario.</p>
<pre><code class="language-python">def f(x, y, **kwargs):
    # x -&gt; 2
    # y -&gt; 3
    # kwargs -&gt; { 'flag': True, 'mode': 'fast', 'header': 'debug' }
</code></pre>
<h3 id="713-combinando-ambos">7.1.3 Combinando ambos</h3>
<p>Una función también puede aceptar cualquier número de argumentos variables de palabras clave y no palabras clave.</p>
<pre><code class="language-python">def f(*args, **kwargs):
    ...
</code></pre>
<p>Llamada de función.</p>
<pre><code class="language-python">f(2, 3, flag=True, mode='fast', header='debug')
</code></pre>
<p>Los argumentos se separan en componentes posicionales y de palabras clave</p>
<pre><code class="language-python">def f(*args, **kwargs):
    # args = (2, 3)     # kwargs -&gt; { 'flag': True, 'mode': 'fast', 'header': 'debug' }     ...
</code></pre>
<p>Esta función toma cualquier combinación de argumentos posicionales o de palabras clave. A veces se usa al escribir envoltorios o cuando desea pasar argumentos a otra función.</p>
<h3 id="714-pasar-tuplas-y-dictados">7.1.4 Pasar tuplas y dictados</h3>
<p>Las tuplas se pueden expandir en argumentos variables.</p>
<pre><code class="language-python">numbers = (2,3,4)
f(1, *numbers)      # Same as f(1,2,3,4)
</code></pre>
<p>Los diccionarios también se pueden expandir a argumentos de palabras clave.</p>
<pre><code class="language-python">options = {
    'color' : 'red',
    'delimiter' : ',',
    'width' : 400
}
f(data, **options)
# Same as f(data, color='red', delimiter=',', width=400)
</code></pre>
<h3 id="715-ejercicios">7.1.5 Ejercicios</h3>
<h4 id="ejercicio-71-un-ejemplo-simple-de-argumentos-variables">Ejercicio 7.1: un ejemplo simple de argumentos variables</h4>
<p>Intente definir la siguiente función:</p>
<pre><code class="language-python">&gt;&gt;&gt; def avg(x,*more):
        return float(x+sum(more))/(1+len(more))

&gt;&gt;&gt; avg(10,11)
10.5
&gt;&gt;&gt; avg(3,4,5)
4.0
&gt;&gt;&gt; avg(1,2,3,4,5,6)
3.5
&gt;&gt;&gt;
</code></pre>
<p>Observe cómo el parámetro *morerecopila todos los argumentos adicionales.</p>
<h4 id="ejercicio-72-pasar-tuplas-y-dictados-como-argumentos">Ejercicio 7.2: Pasar tuplas y dictados como argumentos</h4>
<p>Suponga que lee algunos datos de un archivo y obtiene una tupla como esta:</p>
<pre><code class="language-python">&gt;&gt;&gt; data = ('GOOG', 100, 490.1)
&gt;&gt;&gt;
</code></pre>
<p>Ahora, suponga que desea crear un objeto <code>Stock</code> a partir de estos datos. Si intenta pasar <code>data</code> directamente, no funciona:</p>
<pre><code class="language-python">&gt;&gt;&gt; from stock import Stock
&gt;&gt;&gt; s = Stock(data)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
TypeError: __init__() takes exactly 4 arguments (2 given)
&gt;&gt;&gt;
</code></pre>
<p>Esto se soluciona fácilmente usando <code>*data</code> en su lugar. Prueba esto:</p>
<pre><code class="language-python">&gt;&gt;&gt; s = Stock(*data)
&gt;&gt;&gt; s
Stock('GOOG', 100, 490.1)
&gt;&gt;&gt;
</code></pre>
<p>Si tiene un diccionario, puede utilizar <code>**</code> en su lugar. Por ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; data = { 'name': 'GOOG', 'shares': 100, 'price': 490.1 }
&gt;&gt;&gt; s = Stock(**data)
Stock('GOOG', 100, 490.1)
&gt;&gt;&gt;
</code></pre>
<h4 id="ejercicio-73-crear-una-lista-de-instancias">Ejercicio 7.3: Crear una lista de instancias</h4>
<p>En su programa <code>report.py</code>, creó una lista de instancias usando un código como este:</p>
<pre><code class="language-python">def read_portfolio(filename):
    ''' Read a stock portfolio file into a list of dictionaries with keys name, shares, and price. '''
    with open(filename) as lines:
        portdicts = fileparse.parse_csv(lines,
                               select=['name','shares','price'],
                               types=[str,int,float])

    portfolio = [ Stock(d['name'], d['shares'], d['price'])
                  for d in portdicts ]
    return Portfolio(portfolio)
</code></pre>
<p>Puede simplificar ese código usando <code>Stock(**d)</code>. Haz ese cambio.</p>
<h4 id="ejercicio-74-transferencia-de-argumentos">Ejercicio 7.4: Transferencia de argumentos</h4>
<p>La función <code>fileparse.parse_csv()</code> tiene algunas opciones para cambiar el delimitador de archivos y para informar de errores. Tal vez le gustaría exponer esas opciones a la función <code>read_portfolio()</code> anterior. Haz este cambio:</p>
<pre><code class="language-python">def read_portfolio(filename, **opts):
    '''
    Read a stock portfolio file into a list of dictionaries with keys
    name, shares, and price.
    '''
    with open(filename) as lines:
        portdicts = fileparse.parse_csv(lines,
                                        select=['name','shares','price'],
                                        types=[str,int,float],
                                        **opts)

    portfolio = [ Stock(**d) for d in portdicts ]
    return Portfolio(portfolio)
</code></pre>
<p>Una vez que haya realizado el cambio, intente leer un archivo con algunos errores:</p>
<pre><code class="language-python">&gt;&gt;&gt; import report
&gt;&gt;&gt; port = report.read_portfolio('Data/missing.csv')
Row 4: Couldn't convert ['MSFT', '', '51.23'] Row 4: Reason invalid literal for int() with base 10: '' Row 7: Couldn't convert ['IBM', '', '70.44']
Row 7: Reason invalid literal for int() with base 10: ''
&gt;&gt;&gt;
</code></pre>
<p>Ahora, intente silenciar los errores:</p>
<pre><code class="language-python">&gt;&gt;&gt; import report
&gt;&gt;&gt; port = report.read_portfolio('Data/missing.csv', silence_errors=True)
&gt;&gt;&gt;
</code></pre>
<h2 id="72-funciones-anonimas-y-lambda">7.2 Funciones anónimas y lambda</h2>
<h3 id="721-clasificacion-de-listas-revisada">7.2.1 Clasificación de listas revisada</h3>
<p>Las listas se pueden ordenar in situ . Usando el sortmétodo.</p>
<pre><code class="language-python">s = [10,1,7,3]
s.sort() # s = [1,3,7,10]
</code></pre>
<p>Puede ordenar en orden inverso.</p>
<pre><code class="language-python">s = [10,1,7,3]
s.sort(reverse=True) # s = [10,7,3,1]
</code></pre>
<p>Parece bastante simple. Sin embargo, ¿cómo ordenamos una lista de dictados?</p>
<pre><code class="language-python">[{'name': 'AA', 'price': 32.2, 'shares': 100},
{'name': 'IBM', 'price': 91.1, 'shares': 50},
{'name': 'CAT', 'price': 83.44, 'shares': 150},
{'name': 'MSFT', 'price': 51.23, 'shares': 200},
{'name': 'GE', 'price': 40.37, 'shares': 95},
{'name': 'MSFT', 'price': 65.1, 'shares': 50},
{'name': 'IBM', 'price': 70.44, 'shares': 100}]
</code></pre>
<p>¿Con qué criterios?</p>
<p>Puede guiar la clasificación utilizando una función clave . La función clave es una función que recibe el diccionario y devuelve el valor de interés para ordenar.</p>
<pre><code class="language-python">def stock_name(s):
    return s['name']

portfolio.sort(key=stock_name)
</code></pre>
<p>Aquí está el resultado.</p>
<pre><code class="language-python"># Check how the dictionaries are sorted by the `name` key [
  {'name': 'AA', 'price': 32.2, 'shares': 100},
  {'name': 'CAT', 'price': 83.44, 'shares': 150},
  {'name': 'GE', 'price': 40.37, 'shares': 95},
  {'name': 'IBM', 'price': 91.1, 'shares': 50},
  {'name': 'IBM', 'price': 70.44, 'shares': 100},
  {'name': 'MSFT', 'price': 51.23, 'shares': 200},
  {'name': 'MSFT', 'price': 65.1, 'shares': 50}
]
</code></pre>
<h3 id="722-funciones-de-devolucion-de-llamada">7.2.2 Funciones de devolución de llamada</h3>
<p>En el ejemplo anterior, la función de tecla es un ejemplo de función de devolución de llamada. El método <code>sort()</code> "vuelve a llamar" a una función que usted proporciona. Las funciones de devolución de llamada suelen ser funciones breves de una línea que solo se utilizan para esa operación. Los programadores a menudo piden un atajo para especificar este procesamiento adicional.</p>
<h3 id="723-lambda-funciones-anonimas">7.2.3 Lambda: funciones anónimas</h3>
<p>Utilice una lambda en lugar de crear la función. En nuestro ejemplo de clasificación anterior.</p>
<pre><code class="language-python">portfolio.sort(key=lambda s: s['name'])
</code></pre>
<p>Esto crea una función sin nombre que evalúa una sola expresión. El código anterior es mucho más corto que el código inicial.</p>
<pre><code class="language-python">def stock_name(s):
    return s['name']

portfolio.sort(key=stock_name)
# vs lambda
portfolio.sort(key=lambda s: s['name'])
</code></pre>
<h3 id="724-usando-lambda">7.2.4 Usando lambda</h3>
<ul>
<li>lambda está muy restringido.</li>
<li>Solo se permite una expresión.</li>
<li>No hay declaraciones como if, while, etc.</li>
<li>El uso más común es con funciones como sort().</li>
</ul>
<h3 id="725-ejercicios">7.2.5 Ejercicios</h3>
<p>Lea algunos datos de la cartera de acciones y conviértalos en una lista:</p>
<pre><code class="language-python">&gt;&gt;&gt; import report
&gt;&gt;&gt; portfolio = list(report.read_portfolio('Data/portfolio.csv'))
&gt;&gt;&gt; for s in portfolio:
        print(s)

Stock('AA', 100, 32.2)
Stock('IBM', 50, 91.1)
Stock('CAT', 150, 83.44)
Stock('MSFT', 200, 51.23)
Stock('GE', 95, 40.37)
Stock('MSFT', 50, 65.1)
Stock('IBM', 100, 70.44)
&gt;&gt;&gt;
</code></pre>
<h4 id="ejercicio-75-ordenar-en-un-campo">Ejercicio 7.5: ordenar en un campo</h4>
<p>Pruebe las siguientes afirmaciones que ordenan los datos de la cartera alfabéticamente por nombre de la acción.</p>
<pre><code class="language-python">&gt;&gt;&gt; def stock_name(s):
       return s.name

&gt;&gt;&gt; portfolio.sort(key=stock_name)
&gt;&gt;&gt; for s in portfolio:
           print(s)

... inspeccione los resultados ...
&gt;&gt;&gt;
</code></pre>
<p>En esta parte, la stock_name()función extrae el nombre de una acción de una sola entrada en la portfoliolista. <code>sort()</code> usa el resultado de esta función para hacer la comparación.</p>
<h4 id="ejercicio-76-ordenar-en-un-campo-con-lambda">Ejercicio 7.6: ordenar en un campo con lambda</h4>
<p>Intente ordenar la cartera de acuerdo con la cantidad de acciones usando una lambdaexpresión:</p>
<pre><code class="language-python">&gt;&gt;&gt; portfolio.sort(key=lambda s: s.shares)
&gt;&gt;&gt; for s in portfolio:
        print(s)

... inspeccione los resultados ...
&gt;&gt;&gt;
</code></pre>
<p>Intente ordenar la cartera según el precio de cada acción</p>
<pre><code class="language-python">&gt;&gt;&gt; portfolio.sort(key=lambda s: s.price)
&gt;&gt;&gt; for s in portfolio:
        print(s)

... inspeccione los resultados ...
&gt;&gt;&gt;
</code></pre>
<p>Nota: lambdaes un atajo útil porque le permite definir una función de procesamiento especial directamente en la llamada a <code>sort()</code> en lugar de tener que definir primero una función separada.</p>
<h2 id="73-funcion-de-retorno-y-cierres">7.3 Función de retorno y cierres</h2>
<p>Esta sección presenta la idea de usar funciones para crear otras funciones.</p>
<h3 id="731-introduccion">7.3.1 Introducción</h3>
<p>Considere la siguiente función.</p>
<pre><code class="language-python">def add(x, y):
    def do_add():
        print('Adding', x, y)
        return x + y
    return do_add
</code></pre>
<p>Esta es una función que devuelve otra función.</p>
<pre><code class="language-python">&gt;&gt;&gt; a = add(3,4)
&gt;&gt;&gt; a
&lt;function do_add at 0x6a670&gt;
&gt;&gt;&gt; a()
Adding 3 4
7
</code></pre>
<h3 id="732-variables-locales">7.3.2 Variables locales</h3>
<p>Observe cómo la función interna se refiere a variables definidas por la función externa.</p>
<pre><code class="language-python">def add(x, y):
    def do_add():
        # `x` and `y` are defined above `add(x, y)`
        print('Adding', x, y)
        return x + y
    return do_add
</code></pre>
<p>Observe además que esas variables se mantienen vivas de alguna manera después de que add()ha terminado.</p>
<pre><code class="language-python">&gt;&gt;&gt; a = add(3,4)
&gt;&gt;&gt; a
&lt;function do_add at 0x6a670&gt;
&gt;&gt;&gt; a()
Adding 3 4      # Where are these values coming from?
7
</code></pre>
<h3 id="733-cierres">7.3.3 Cierres</h3>
<p>Cuando se devuelve una función interna como resultado, esa función interna se conoce como cierre .</p>
<pre><code class="language-python">def add(x, y):
    # `do_add` is a closure
    def do_add():
        print('Adding', x, y)
        return x + y
    return do_add
</code></pre>
<p>Característica esencial: un cierre conserva los valores de todas las variables necesarias para que la función se ejecute correctamente más adelante. Piense en un cierre como una función más un entorno adicional que contiene los valores de las variables de las que depende.</p>
<h3 id="734-usando-cierres">7.3.4 Usando cierres</h3>
<p>El cierre es una característica esencial de Python. Sin embargo, su uso suele ser sutil. Aplicaciones habituales:</p>
<ul>
<li>Utilizar en funciones de devolución de llamada.</li>
<li>Evaluación retrasada.</li>
<li>Funciones de decorador (más tarde).</li>
</ul>
<h3 id="735-evaluacion-retrasada">7.3.5 Evaluación retrasada</h3>
<p>Considere una función como esta:</p>
<pre><code class="language-python">def after(seconds, func):
    import time
    time.sleep(seconds)
    func()
</code></pre>
<p>Ejemplo de uso:</p>
<pre><code class="language-python">def greeting():
    print('Hello Guido')

after(30, greeting)
</code></pre>
<p><code>after</code> ejecuta la función proporcionada más tarde.</p>
<p>Los cierres llevan información adicional.</p>
<pre><code class="language-python">def add(x, y):
    def do_add():
        print(f'Adding {x} + {y} -&gt; {x+y}')
    return do_add

def after(seconds, func):
    import time
    time.sleep(seconds)
    func()

after(30, add(2, 3))
# `do_add` has the references x -&gt; 2 and y -&gt; 3
</code></pre>
<h3 id="736-repeticion-de-codigo">7.3.6 Repetición de código</h3>
<p>Los cierres también se pueden utilizar como técnica para evitar la repetición excesiva de código. Puede escribir funciones que hacen código.</p>
<h3 id="737-ejercicios">7.3.7 Ejercicios</h3>
<h4 id="ejercicio-77-uso-de-cierres-para-evitar-la-repeticion">Ejercicio 7.7: Uso de cierres para evitar la repetición</h4>
<p>Una de las características más poderosas de los cierres es su uso para generar código repetitivo. Si vuelve a consultar el ejercicio 5.7 , recuerde el código para definir una propiedad con verificación de tipos.</p>
<pre><code class="language-python">class Stock:
    def __init__(self, name, shares, price):
        self.name = name
        self.shares = shares
        self.price = price
    ...
    @property
    def shares(self):
        return self._shares

    @shares.setter
    def shares(self, value):
        if not isinstance(value, int):
            raise TypeError('Expected int')
        self._shares = value
    ...
</code></pre>
<p>En lugar de escribir ese código repetidamente una y otra vez, puede crearlo automáticamente usando un cierre.</p>
<p>Haga un archivo typedproperty.pyy coloque el siguiente código en él:</p>
<pre><code class="language-python"># typedproperty.py
def typedproperty(name, expected_type):
    private_name = '_' + name
    @property
    def prop(self):
        return getattr(self, private_name)

    @prop.setter
    def prop(self, value):
        if not isinstance(value, expected_type):
            raise TypeError(f'Expected {expected_type}')
        setattr(self, private_name, value)

    return prop
</code></pre>
<p>Ahora, pruébelo definiendo una clase como esta:</p>
<pre><code class="language-python">from typedproperty import typedproperty

class Stock:
    name = typedproperty('name', str)
    shares = typedproperty('shares', int)
    price = typedproperty('price', float)

    def __init__(self, name, shares, price):
        self.name = name
        self.shares = shares
        self.price = price
</code></pre>
<p>Intente crear una instancia y verificar que la verificación de tipos funcione.</p>
<pre><code class="language-python">&gt;&gt;&gt; s = Stock('IBM', 50, 91.1)
&gt;&gt;&gt; s.name
'IBM'
&gt;&gt;&gt; s.shares = '100'
... should get a TypeError ...
&gt;&gt;&gt;
</code></pre>
<h4 id="ejercicio-78-simplificacion-de-llamadas-a-funciones">Ejercicio 7.8: Simplificación de llamadas a funciones</h4>
<p>En el ejemplo anterior, los usuarios pueden encontrar llamadas typedproperty('shares', int)un poco detalladas para escribir, especialmente si se repiten mucho. Agregue las siguientes definiciones al typedproperty.pyarchivo:</p>
<pre><code class="language-python">String = lambda name: typedproperty(name, str)
Integer = lambda name: typedproperty(name, int)
Float = lambda name: typedproperty(name, float)
</code></pre>
<p>Ahora, reescribe la Stockclase para usar estas funciones en su lugar:</p>
<pre><code class="language-python">class Stock:
    name = String('name')
    shares = Integer('shares')
    price = Float('price')

    def __init__(self, name, shares, price):
        self.name = name
        self.shares = shares
        self.price = price
</code></pre>
<p>Ah, eso es un poco mejor. La principal conclusión aquí es que los cierres y lambda, a menudo, se pueden usar para simplificar el código y eliminar la repetición molesta. Suele ser bueno.</p>
<h4 id="ejercicio-79-poniendolo-en-practica">Ejercicio 7.9: Poniéndolo en práctica</h4>
<p>Vuelva a escribir la clase <code>Stock</code> en el archivo <code>stock.py</code> para que utilice propiedades escritas como se muestra.</p>
<h2 id="74-decoradores-de-funciones">7.4 Decoradores de funciones</h2>
<p>Esta sección presenta el concepto de decorador. Este es un tema avanzado para el que solo arañamos la superficie.</p>
<h3 id="741-ejemplo-de-registro">7.4.1 Ejemplo de registro</h3>
<p>Considere una función.</p>
<pre><code class="language-python">def add(x, y):
    return x + y
</code></pre>
<p>Ahora, considere la función con algunos registros agregados.</p>
<pre><code class="language-python">def add(x, y):
    print('Calling add')
    return x + y
</code></pre>
<p>Ahora una segunda función también con algunos registros.</p>
<pre><code class="language-python">def sub(x, y):
    print('Calling sub')
    return x - y
</code></pre>
<h3 id="742-observacion">7.4.2 Observación</h3>
<p>Observación: es algo repetitivo.</p>
<p>Escribir programas donde hay mucha replicación de código a menudo es realmente molesto. Son tediosos de escribir y difíciles de mantener. Especialmente si decide que desea cambiar cómo funciona (es decir, quizás un tipo diferente de registro).</p>
<h3 id="743-codigo-que-hace-el-registro">7.4.3 Código que hace el registro</h3>
<p>Quizás pueda crear una función que haga funciones con registro agregado a ellas. Una envoltura.</p>
<pre><code class="language-python">def logged(func):
    def wrapper(*args, **kwargs):
        print('Calling', func.__name__)
        return func(*args, **kwargs)
    return wrapper
</code></pre>
<p>Ahora úsalo.</p>
<pre><code class="language-python">def add(x, y):
    return x + y

logged_add = logged(add)
</code></pre>
<p>¿Qué sucede cuando llamas a la función devuelta por logged?</p>
<pre><code class="language-python">logged_add(3, 4)      # Usted ve que el mensaje aparece
</code></pre>
<p>Este ejemplo ilustra el proceso de creación de la denominada función contenedora .</p>
<p>Una envoltura es una función que envuelve otra función con algunos bits adicionales de procesamiento, pero por lo demás funciona exactamente de la misma manera que la función original.</p>
<pre><code class="language-python">&gt;&gt;&gt; logged_add(3, 4)
Calling add   # Extra output. Added by the wrapper 7
&gt;&gt;&gt;
</code></pre>
<p>Nota: La <code>logged()</code> función crea el contenedor y lo devuelve como resultado.</p>
<h3 id="744-decoradores">7.4.4 Decoradores</h3>
<p>Poner envoltorios alrededor de funciones es extremadamente común en Python. Tan común que tiene una sintaxis especial.</p>
<pre><code class="language-python">def add(x, y):
    return x + y
add = logged(add)

# Sintaxis especial @logged
def add(x, y):
    return x + y
</code></pre>
<p>La sintaxis especial realiza exactamente los mismos pasos que se muestran arriba. Un decorador es solo una nueva sintaxis. Se dice que decora la función.</p>
<h4 id="comentario">Comentario</h4>
<p>Hay muchos más detalles sutiles para los decoradores de los que se han presentado aquí. Por ejemplo, usándolos en clases. O usando múltiples decoradores con una función. Sin embargo, el ejemplo anterior es una buena ilustración de cómo tiende a surgir su uso. Por lo general, es en respuesta al código repetitivo que aparece en una amplia gama de definiciones de funciones. Un decorador puede mover ese código a una definición central.</p>
<h3 id="745-ejercicios">7.4.5 Ejercicios</h3>
<h4 id="ejercicio-710-un-decorador-de-tiempos">Ejercicio 7.10: un decorador de tiempos</h4>
<p>Si define una función, su nombre y módulo se almacenan en los atributos <code>__name__</code> y <code>__module__</code>. Por ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; def add(x,y):
     return x+y

&gt;&gt;&gt; add.__name__
'add'
&gt;&gt;&gt; add.__module__
'__main__'
&gt;&gt;&gt;
</code></pre>
<p>En un archivo <code>timethis.py</code>, escriba una función decoradora <code>timethis(func)</code> que envuelva una función con una capa adicional de lógica que imprima cuánto tarda en ejecutarse una función. Para hacer esto, rodeará la función con llamadas de tiempo como esta:</p>
<pre><code class="language-python">start = time.time()
r = func(*args,**kwargs)
end = time.time()
print('%s.%s: %f' % (func.__module__, func.__name__, end-start))
</code></pre>
<p>Aquí tienes un ejemplo de cómo debería funcionar tu decorador:</p>
<pre><code class="language-python">&gt;&gt;&gt; from timethis import timethis
&gt;&gt;&gt; @timethis
def countdown(n):
        while n &gt; 0:
             n -= 1

&gt;&gt;&gt; countdown(10000000)
__main__.countdown : 0.076562
&gt;&gt;&gt;
</code></pre>
<p>Discusión: Este decorador <code>@timethis</code> se puede colocar delante de cualquier definición de función. Por lo tanto, puede usarlo como una herramienta de diagnóstico para ajustar el rendimiento.</p>
<h2 id="75-metodos-estaticos-y-de-clase">7.5 Métodos estáticos y de clase</h2>
<p>En esta sección se analizan algunos decoradores integrados que se utilizan en combinación con definiciones de métodos.</p>
<h3 id="751-decoradores-predefinidos">7.5.1 Decoradores predefinidos</h3>
<p>Hay decoradores predefinidos que se utilizan para especificar tipos especiales de métodos en las definiciones de clases.</p>
<pre><code class="language-python">class Foo:
    def bar(self,a):
        ...

    @staticmethod
    def spam(a):
        ...

    @classmethod
    def grok(cls,a):
        ...

    @property
    def name(self):
        ...
</code></pre>
<p>Vayamos uno por uno.</p>
<h3 id="752-metodos-estaticos">7.5.2 Métodos estáticos</h3>
<p><code>@staticmethod</code> se utiliza para definir los llamados métodos de clase estática (de C ++ / Java). Un método estático es una función que forma parte de la clase, pero que no opera en instancias.</p>
<pre><code class="language-python">class Foo(object):
    @staticmethod
    def bar(x):
        print('x =', x)

&gt;&gt;&gt; Foo.bar(2) x=2
&gt;&gt;&gt;
</code></pre>
<p>Los métodos estáticos se utilizan a veces para implementar código de soporte interno para una clase. Por ejemplo, código para ayudar a administrar las instancias creadas (administración de memoria, recursos del sistema, persistencia, bloqueo, etc.). También son utilizados por ciertos patrones de diseño (no discutidos aquí).</p>
<h3 id="753-metodos-de-clase">7.5.3 Métodos de clase</h3>
<p><code>@classmethod</code> se utiliza para definir métodos de clase. Un método de clase es un método que recibe el objeto de clase como primer parámetro en lugar de la instancia.</p>
<pre><code class="language-python">class Foo:
    def bar(self):
        print(self)

    @classmethod
    def spam(cls):
        print(cls)

&gt;&gt;&gt; f = Foo()
&gt;&gt;&gt; f.bar()
&lt;__main__.Foo object at 0x971690&gt;   # La instancia `f`
&gt;&gt;&gt; Foo.spam()
&lt;class '__main__.Foo'&gt; # La clase `Foo`
&gt;&gt;&gt;
</code></pre>
<p>Los métodos de clase se utilizan con mayor frecuencia como una herramienta para definir constructores alternativos.</p>
<pre><code class="language-python">class Date:
    def __init__(self,year,month,day):
        self.year = year
        self.month = month
        self.day = day

    @classmethod
    def today(cls):
        # Notice how the class is passed as an argument
        tm = time.localtime()
        # And used to create a new instance
        return cls(tm.tm_year, tm.tm_mon, tm.tm_mday)

d = Date.today()
</code></pre>
<p>Los métodos de clase resuelven algunos problemas complicados con características como la herencia.</p>
<pre><code class="language-python">class Date:
    ...
    @classmethod
    def today(cls):
        # Gets the correct class (e.g. `NewDate`)
        tm = time.localtime()
        return cls(tm.tm_year, tm.tm_mon, tm.tm_mday)

class NewDate(Date):
    ...

d = NewDate.today()
</code></pre>
<h3 id="754-ejercicios">7.5.4 Ejercicios</h3>
<h4 id="ejercicio-711-metodos-de-clase-en-la-practica">Ejercicio 7.11: Métodos de clase en la práctica</h4>
<p>En sus archivos <code>report.py</code> y <code>portfolio.py</code>, la creación de un objeto <code>Portfolio</code> es un poco confusa. Por ejemplo, el programa <code>report.py</code> tiene un código como este:</p>
<pre><code class="language-python">def read_portfolio(filename, **opts):
    '''
    Read a stock portfolio file into a list of dictionaries with keys name, shares, and price.
    '''
    with open(filename) as lines:
        portdicts = fileparse.parse_csv(lines,
                                        select=['name','shares','price'],
                                        types=[str,int,float],
                                        **opts)

    portfolio = [ Stock(**d) for d in portdicts ]
    return Portfolio(portfolio)
</code></pre>
<p>y el archivo <code>portfolio.py</code> se define <code>Portfolio()</code> con un inicializador extraño como este:</p>
<pre><code class="language-python">class Portfolio:
    def __init__(self, holdings):
        self.holdings = holdings
    ...
</code></pre>
<p>Francamente, la cadena de responsabilidad es un poco confusa porque el código está disperso. Si Portfolio se supone que una clase contiene una lista de instancias <code>Stock</code>, tal vez debería cambiar la clase para que sea un poco más clara. Me gusta esto:</p>
<pre><code class="language-python"># portfolio.py
import stock

class Portfolio:
    def __init__(self):
        self.holdings = []

    def append(self, holding):
        if not isinstance(holding, stock.Stock):
            raise TypeError('Expected a Stock instance')
        self.holdings.append(holding)
    ...
</code></pre>
<p>Si desea leer un portafolio de un archivo CSV, tal vez debería crear un método de clase para él:</p>
<pre><code class="language-python"># portfolio.py
import fileparse
import stock

class Portfolio:
    def __init__(self):
        self.holdings = []

    def append(self, holding):
        if not isinstance(holding, stock.Stock):
            raise TypeError('Expected a Stock instance')
        self.holdings.append(holding)

    @classmethod
    def from_csv(cls, lines, **opts):
        self = cls()
        portdicts = fileparse.parse_csv(lines,
                                        select=['name','shares','price'],
                                        types=[str,int,float],
                                        **opts)

        for d in portdicts:
            self.append(stock.Stock(**d))

        return self
</code></pre>
<p>Para usar esta nueva clase <code>Portfolio</code>, ahora puede escribir código como este:</p>
<pre><code class="language-python">&gt;&gt;&gt; from portfolio import Portfolio
&gt;&gt;&gt; with open('Data/portfolio.csv') as lines:
...     port = Portfolio.from_csv(lines)
...
&gt;&gt;&gt;
</code></pre>
<p>Realice estos cambios en la clase <code>Portfolio</code> y modifique el código <code>report.py</code> para usar el método de la clase.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../8/" class="btn btn-neutral float-right" title="8 Prueba y Depuración">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../6/" class="btn btn-neutral" title="6 Generadores"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../6/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../8/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
